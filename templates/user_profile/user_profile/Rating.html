<div class="tab-pane fade pt-3" id="profile-settings">

    <!-- Performance Rating Section -->

    <style>
        /* Basic styling for ratings */
        .rating-container {
            margin-bottom: 20px;
        }
        .rating-label {
            font-weight: bold;
        }
        .rating-bar {
            height: 20px;
            background-color: rgb(205, 182, 107);
            border-radius: 5px;
            margin-bottom: 5px;
            transition: width 2s ease-in-out;
        }
        .chart-container {
            width: 400px;
            height: 300px;
            margin-top: 20px;
        }
    </style>

    <div class="rating-container" id="qualityOfWorkContainer">
        <span class="rating-label">Quality of Work:</span>
        <div class="rating-bar" id="qualityBar"></div>
        <span id="qualityPercentage"></span>
    </div>

    <div class="rating-container" id="communicationSkillsContainer">
        <span class="rating-label">Communication Skills:</span>
        <div class="rating-bar" id="communicationBar"></div>
        <span id="communicationPercentage"></span>
    </div>

    <div class="rating-container" id="punctualityContainer">
        <span class="rating-label">Punctuality:</span>
        <div class="rating-bar" id="punctualityBar"></div>
        <span id="punctualityPercentage"></span>
    </div>

    <div class="rating-container" id="teamCollaborationContainer">
        <span class="rating-label">Team Collaboration:</span>
        <div class="rating-bar" id="collaborationBar"></div>
        <span id="collaborationPercentage"></span>
    </div>
    <!-- End Performance Rating Section -->

    <!-- Pie Chart for Overall Performance Distribution -->
    <div class="chart-container">
        <canvas id="performancePieChart"></canvas>
    </div>
    <!-- End Pie Chart -->

</div>

<script>
    // Animate the rating bars and load pie chart on page load
    document.addEventListener('DOMContentLoaded', async () => {
        const qualityBar = document.getElementById('qualityBar');
        const communicationBar = document.getElementById('communicationBar');
        const punctualityBar = document.getElementById('punctualityBar');
        const collaborationBar = document.getElementById('collaborationBar');
        const qualityPercentage = document.getElementById('qualityPercentage');
        const communicationPercentage = document.getElementById('communicationPercentage');
        const punctualityPercentage = document.getElementById('punctualityPercentage');
        const collaborationPercentage = document.getElementById('collaborationPercentage');

        const supabase = createClient('https://dqkquwhmpmmswxcyrqem.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRxa3F1d2htcG1tc3d4Y3lycWVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ3NDI3MzYsImV4cCI6MjAzMDMxODczNn0.laxhsxnF-Sbsh_FhulaODDPgFeUxKWKfWPUO20RG_tE');

        // Fetch ratings from Supabase
        const { data, error } = await supabase
            .from('ratings')
            .select('*');

        if (error) {
            console.error('Error fetching ratings:', error);
        } else {
            data.forEach(rating => {
                switch (rating.category) {
                    case 'Quality of Work':
                        qualityBar.style.width = `${rating.rating_percentage}%`;
                        qualityPercentage.textContent = `${rating.rating_percentage}%`;
                        break;
                    case 'Communication Skills':
                        communicationBar.style.width = `${rating.rating_percentage}%`;
                        communicationPercentage.textContent = `${rating.rating_percentage}%`;
                        break;
                    case 'Punctuality':
                        punctualityBar.style.width = `${rating.rating_percentage}%`;
                        punctualityPercentage.textContent = `${rating.rating_percentage}%`;
                        break;
                    case 'Team Collaboration':
                        collaborationBar.style.width = `${rating.rating_percentage}%`;
                        collaborationPercentage.textContent = `${rating.rating_percentage}%`;
                        break;
                    default:
                        break;
                }
            });
        }

        // Prepare data for pie chart
        const categories = ['Quality of Work', 'Communication Skills', 'Punctuality', 'Team Collaboration'];
        const ratings = [80, 70, 90, 75]; // Sample ratings percentages

        // Create pie chart
        const ctx = document.getElementById('performancePieChart').getContext('2d');
        const performancePieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: categories,
                datasets: [{
                    label: 'Performance Distribution',
                    data: ratings,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 205, 86, 0.5)',
                        'rgba(75, 192, 192, 0.5)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return tooltipItem.label + ': ' + tooltipItem.raw.toFixed(2) + '%';
                            }
                        }
                    }
                }
            }
        });
    });
</script>
